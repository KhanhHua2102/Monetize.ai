<!DOCTYPE html>
<html>
<head>
    <title>Stock Profit Calculator</title>
    
</head>
<style>
    /* Add styles to the header */
header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #f9f9f9;
  padding: 20px;
  border-bottom: 1px solid #ddd;
}

header h1 {
  margin: 0;
  font-size: 36px;
}

header a {
  color: #333;
  font-size: 18px;
  text-decoration: none;
}

/* Add styles to the table */
table {
  border-collapse: collapse;
  width: 100%;
  margin-bottom: 40px;
}

thead {
  background-color: #f9f9f9;
}

th {
  text-align: left;
  padding: 12px;
  font-weight: bold;
  font-size: 18px;
}

td {
  border: 1px solid #ddd;
  padding: 12px;
  font-size: 16px;
}

td input {
  font-size: 16px;
}

td:nth-child(5),
td:nth-child(6),
td:nth-child(8) {
  text-align: right;
}

td:nth-child(5)::before,
td:nth-child(6)::before {
  content: "$";
}

td:nth-child(8)::before {
  content: "$";
  font-weight: bold;
}

/* Add styles to the buttons */
button {
  background-color: #008cba;
  color: #fff;
  font-size: 18px;
  padding: 10px 20px;
  border-radius: 5px;
  border: none;
  margin-right: 20px;
  cursor: pointer;
}

button:hover {
  background-color: #005b80;
}

#total-profit {
  font-weight: bold;
  font-size: 24px;
}

</style>
<body>
    <h1>Stock Profit Calculator</h1>

    

    <br>

    <table>
        <thead>
            <tr>
                <th>Ticker Symbol</th>
                <th>Selected Date</th>
                <th>End Date</th>
                <th>Company Name</th>
                <th>Start Close Price</th>
                <th>End Close Price</th>
                <th>Shares</th>
                <th>Profit/Loss</th>
            </tr>
        </thead>
        <tbody>
            {% for stock in stocks %}
<tr>
    <td>{{ stock.ticker_symbol }}</td>
    <td>{{ stock.selected_date }}</td>
    <td>{{ stock.end_date }}</td>
    <td>{{ stock.company_name }}</td>
    <td>{{ '{:.2f}'.format(stock.start_close_price) }}</td>
    <td>{{ '{:.2f}'.format(stock.end_close_price) }}</td>
    <td>{{ stock.shares }}</td>
    <td>{{ '{:.2f}'.format(stock.profit) }}</td>
</tr>
{% endfor %}
        </tbody>
    </table>

    <br>

    <button onclick="addStock()">Add Another Stock</button>
    <button onclick="calculateTotalProfit()">Total Profits/Loss</button>
<p>Total Profits/Loss: $ <span id="total-profit"></span></p>

   
   

    <script>
       function addStock() {
    var table = document.querySelector("table");
    var row = table.insertRow(-1);
    var tickerSymbol = row.insertCell(0);
    var selectedDate = row.insertCell(1);
    var endDate = row.insertCell(2);
    var companyName = row.insertCell(3);
    var startClosePrice = row.insertCell(4);
    var endClosePrice = row.insertCell(5);
    var shares = row.insertCell(6);
    var profit = row.insertCell(7);

    tickerSymbol.innerHTML = '<input type="text" name="ticker_symbol" required>';
    selectedDate.innerHTML = '<input type="date" name="selected_date" required>';
    endDate.innerHTML = '<input type="date" name="end_date" required>';
    companyName.innerHTML = '';
    startClosePrice.innerHTML = '';
    endClosePrice.innerHTML = '';
    shares.innerHTML = '<input type="number" name="Shares" required>';
    profit.innerHTML = '';

    // add event listener for the new row's submit button
    var submitButton = document.createElement("button");
    submitButton.textContent = "Calculate Profit";
    submitButton.onclick = function() {
        // get input values from the new row
        var tickerSymbolValue = tickerSymbol.querySelector("input").value;
        var selectedDateValue = selectedDate.querySelector("input").value;
        var endDateValue = endDate.querySelector("input").value;
        var sharesValue = shares.querySelector("input").value;

        // make API call to get stock data
        fetch(`/get_stock_data?ticker_symbol=${tickerSymbolValue}&selected_date=${selectedDateValue}&end_date=${endDateValue}`)
        .then(response => response.json())
        .then(data => {
            // fill in the missing values for the new row
            companyName.textContent = data.company_name;
            startClosePrice.textContent = data.start_close_price.toFixed(2);
            endClosePrice.textContent = data.end_close_price.toFixed(2);
            shares.textContent = sharesValue;
            profit.textContent = ((data.end_close_price - data.start_close_price) * sharesValue).toFixed(2);
        })
        .catch(error => console.log(error));
    }

    profit.appendChild(submitButton);

    // attach event listener to the new button
    submitButton.addEventListener('click', function(e) {
        e.preventDefault();
        submitButton.click();
    });

}
function calculateTotalProfit() {
  var totalProfit = 0;
  var profitCells = document.querySelectorAll("td:nth-child(8)");

  for (var i = 0; i < profitCells.length; i++) {
    totalProfit += parseFloat(profitCells[i].textContent);
  }

  document.getElementById("total-profit").textContent = totalProfit.toFixed(2);
}

    </script>
</body>
</html>
